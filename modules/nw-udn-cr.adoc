//module included in the following assembly:
//
// *networking/multiple_networks/understanding-user-defined-networks.adoc

:_mod-docs-content-type: PROCEDURE
[id="nw-udn-cr_{context}"]
= Creating a UserDefinedNetwork custom resource

The following procedure sets up a user-defined network that is namespace scoped.

.Prerequisites
* You must

.Procedure

[NOTE]
====
If any cluster default networked pods exist before the user-defined network is created, any further pods created in this namespace will return an error message: `What_is_this`.
====

. Create a request for a user-defined network:

.. Create a yaml file, such as `my-udn-request.yaml`, to define your request with content like the following example:
+
[source, yaml]
----
apiVersion: k8s.ovn.org/v1
kind: UserDefinedNetwork
metadata:
  name: udn-1 # <1>
  namespace: default
spec:
  topology: Layer2 # <2>
  layer2:
    role: Primary # <3>
    mtu: 9000 # <4>
    subnets:
      - "10.0.0.0/24"
      - "2001:db8::/64" # <5>
    excludeSubnets:
      - "10.0.0.0/26"
      - "2001:db8::/80" # <6>
    JoinSubnets: [] # <7>
    IPAMLifecycle: Persistent # <8>
----
<1> Name of your `UserDefinedNetwork` resource. This should not be `default`.
<2> The layer you wish to create the network on. The `topology` field accepts values of `Layer2` and `Layer3`.
<3> Specifies `Primary` or `Secondary`. `Primary` is the only `role` specification supported in {product-version}.
<4> The maximum transmission units (MTU) the default value is `1400`.
<5> Specifies the subnet to be used for the network across the cluster. Supports both IPv6 and dual-stack. For example, `192.168.100.0/24`,`2001:DBB::/64`. Dual-stack may set two subnets otherwise only one is allowed. When the `topology` field is set to `Layer3`, the subnet is split into smaller subnets for every node. Accepted format for subnets when `Layer3` is set are: `10.128.0.0/16/24`. For `Layer2` values in `topology` field, standard CIDR ranges are accepted. If omitted the network only provides `Layer2` communication and you must configure IP addresses.
<6> Specifies the CIDR range to remove from the assignable IP address pool excluding them from being assigned to pods.
<7> Specifies the `subnets` used inside the OVN-Kubernetes network topology. If omitted, the OVN-Kubernetes network plugin assigns one, which is subject to change over time.
<8> Specifies the IP address management system (IPAM). The `Persistent` value specifies that workloads have persistent IP addresses. Assigned by the container network interface (CNI) and used by OVN-Kubernetes to program pod IP addresses. You must not change this for pod annotations.

.. Apply your request by running the following command:
+
[source,terminal]
----
$ oc apply -f my-udn-request.yaml
----

. Verify that your request is successful by running the following command:
+
[source, terminal]
----
$ oc get userdefinednetworks udn-1 -n default -o yaml
----
+
.Example output
[source,terminal]
----
apiVersion: k8s.ovn.org/v1
kind: UserDefinedNetwork
metadata:
  creationTimestamp: "2024-08-28T17:18:47Z"
  finalizers:
  - k8s.ovn.org/user-defined-network-protection
  generation: 1
  name: udn-1
  namespace: default
  resourceVersion: "53313"
  uid: f483626d-6846-48a1-b88e-6bbeb8bcde8c
spec:
  layer2:
    mtu: 9000
    role: Primary
    subnets:
    - 10.0.0.0/24
  topology: Layer2
status:
  conditions:
  - lastTransitionTime: "2024-08-28T17:18:47Z"
    message: NetworkAttachmentDefinition has been created
    reason: NetworkAttachmentDefinitionReady
    status: "True"
    type: NetworkReady
----